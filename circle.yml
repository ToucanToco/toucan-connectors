machine:
  python:
    version: 3.6.2
  services:
    - docker

dependencies:
  pre:
    - sudo apt-get update
    - sudo apt-get install freetds-dev
    - docker-compose -f tests/docker-compose.yml pull
    - pip install -U setuptools

    # oracle
    - sudo apt-get install libaio1
    - sudo mkdir -p /opt/oracle
    - curl -c /tmp/cookie -L -o /tmp/oracle_client_lib.zip "https://drive.google.com/uc?export=download&id=1prPWRnaVMxDsIiSGJqz0TkFT7wXrCgaO"
    - sudo unzip /tmp/oracle_client_lib.zip -d /opt/oracle
    - sudo sh -c "echo /opt/oracle/instantclient_12_2 > /etc/ld.so.conf.d/oracle-instantclient.conf"
    - sudo ldconfig

test:
  override:
    - pip install -r requirements-testing.txt
    - pip install .[all]
    - make test
  post:
    - pip install codecov && codecov --token=3e56598d-bfe8-4741-a973-f4b70bd2c280
